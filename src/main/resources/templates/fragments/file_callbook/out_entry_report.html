<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<div id="b-homedb" th:fragment="tabler">
    <div class="my-5">

        <h3 style="font-size:32px;" class="text-center mb-3 b-latest-data">Files's In Side / Received</h3>

        <script th:inline="javascript">
            $(function () {

              var g_table;
              var ajaxUrl = /*[[@{/callbook/load_callbook_data}]]*/ '';

              g_table = $('#example1').DataTable({
                "processing": true,
                "serverSide": true,
                "ajax": {
                  "url": ajaxUrl,
                  "type": "POST",
                  "contentType": "application/json",
                  "data": function (d) {
                    return JSON.stringify(d);
                  }
                },


                "columns": [
                  { "data": null, "searchable": false, "orderable": false },
                  { "data": "new_drSerialNo" },
                  { "data": "new_dr_year" },
                  { "data": "call_book_no" },
                  { "data": "possible_out_date" },
                  { "data": "sectionDealingHandName" },
                  { "data": "sectionDealingHandPhoneNo" },
                  { "data": "recordRoomDealingHandName" },
                  { "data": "in_out_status" }, // Status
                  { "data": "rack_no" }
                ],

                "responsive": true,
                "lengthChange": false,
                "autoWidth": false,
                "paging": true,
                "pageLength": 100,
                "searching": true,
                "ordering": false,
                "info": true,
                "destroy": true,

                dom: 'Bfrtip',
                buttons: [
                  {
                    extend: 'pdfHtml5',
                    text: 'Export PDF',
                    title: 'Call Book Files List',
                    messageTop: 'Record Room Call Book Files List',
                    customize: function (doc) {
                      doc.pageMargins = [40, 60, 40, 60];
                      doc.defaultStyle.fontSize = 12;
                      doc.styles.tableHeader.fillColor = '#4CAF50';
                      doc.styles.tableHeader.color = 'white';
                      doc.content[0].text = doc.content[0].text.toUpperCase();
                      doc.content[0].alignment = 'center';
                      doc.content[0].fontSize = 18;
                      doc.content[0].margin = [0, 0, 0, 10];
                      doc.footer = function(currentPage, pageCount) {
                        return {
                          columns: [
                            'Left footer text',
                            {
                              text: 'Page ' + currentPage.toString() + ' of ' + pageCount,
                              alignment: 'right',
                              margin: [0, 0, 20, 0]
                            }
                          ],
                          margin: [40, 0]
                        }
                      };
                    },
                    exportOptions: {
                      columns: ':visible'
                    }
                  }
                ],

                "fnRowCallback": function(nRow, aData, iDisplayIndex) {
                  // 1. Calculate Sr. No.
                  var info = g_table.page.info();
                  var page = info.page;
                  var length = info.length;
                  var index = (page * length) + (iDisplayIndex + 1);
                  $('td:eq(0)', nRow).html(index);

                  // 2. Format Status (Column index 8)
                  var status = aData.in_out_status;
                  $('td:eq(8)', nRow).html(status === 0 ? 'InSide' : 'OutSide');

                  // 3. Format Date (Column index 4)
                  var dateIn = aData.possible_out_date;
                  if (dateIn) {
                      try {
                          var date = new Date(dateIn);
                          var formattedDate = date.getDate().toString().padStart(2, '0') + '-' +
                                            (date.getMonth() + 1).toString().padStart(2, '0') + '-' +
                                            date.getFullYear();
                          $('td:eq(4)', nRow).html(formattedDate);
                      } catch(e) {
                           $('td:eq(4)', nRow).html(dateIn); // fallback
                      }
                  }
                }
              });

              // Change search input to number type for DR serial no search
              var searchInput = $('#example1_filter input[type="search"]');
              searchInput.attr('type', 'number');
              searchInput.attr('placeholder', 'Search by DR Serial No...');
            });
        </script>

        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"></h3>
                        </div>
                        <div class="card-body">
                            <table id="example1" class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th>Sr. No.</th>
                                    <th>DR Serial No</th>
                                    <th>DR Year</th>
                                    <th>Call Book Serial No</th>
                                    <th>Due Date</th>
                                    <th>Section Dealing Hand Name</th>
                                    <th>Section Dealing Hand Phone No</th>
                                    <th>Record Room Dealing Hand Name</th>
                                    <th>Status</th>
                                    <th>Rack No</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
</html>