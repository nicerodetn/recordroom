<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<div id="b-homedb" th:fragment="tabler">
    <div class="my-5">
        <h3 style="font-size:32px;" class="text-center mb-3 b-latest-data">Outstanding Old Register Records</h3>

        <script>
            $(function () {
                $('#example1').DataTable({
                    dom: 'Bfrtip',
                    buttons: [
                        {
                            extend: 'pdfHtml5',
                            orientation: 'landscape',
                            text: 'Export PDF',
                            className: 'btn btn-secondary mr-2',
                            filename: 'Old_Register_Outstanding_Report',
                            title: '',
                            customize: function (doc) {
                                doc.pageMargins = [40, 70, 40, 60];
                                doc.defaultStyle.fontSize = 8;
                                doc.content.unshift({
                                    margin: [0, 0, 0, 12],
                                    stack: [
                                        { text: 'Erode District Administration', fontSize: 16, bold: true, alignment: 'center' },
                                        { text: 'Record Room', fontSize: 11, alignment: 'center' },
                                        { text: 'OLD REGISTER OUTSTANDING REPORT', fontSize: 13, bold: true, alignment: 'center', margin: [0, 6, 0, 0] },
                                        { text: 'Generated on: ' + new Date().toLocaleDateString(), fontSize: 9, alignment: 'center' }
                                    ]
                                });
                                doc.styles.tableHeader = { fillColor: '#4CAF50', color: 'white', bold: true, alignment: 'center' };
                            },
                            exportOptions: { columns: ':visible' }
                        },
                        {
                            extend: 'excelHtml5',
                            text: 'Export Excel',
                            className: 'btn btn-secondary',
                            filename: 'Old_Register_Outstanding_Report',
                            title: '',
                            sheetName: 'Report',
                            customize: function (xlsx) {
                                var sheet = xlsx.xl.worksheets['sheet1.xml'];
                                var $sheet = $(sheet);
                                var styles = xlsx.xl['styles.xml'];
                                $(styles).find('xf').each(function () {
                                    var xf = $(this);
                                    if (xf.attr('xfId') === '0') {
                                        xf.attr('applyAlignment', '1');
                                        if (!xf.find('alignment').length) {
                                            xf.append('<alignment horizontal="center" vertical="center"/>');
                                        }
                                    }
                                });
                                $('row', sheet).each(function () {
                                    var r = parseInt($(this).attr('r'));
                                    $(this).attr('r', r + 5);
                                    $('c', this).each(function () {
                                        var ref = $(this).attr('r');
                                        var col = ref.replace(/[0-9]/g, '');
                                        $(this).attr('r', col + (r + 5));
                                    });
                                });
                                var today = new Date().toLocaleDateString();
                                var sheetData = $('sheetData', sheet);
                                sheetData.prepend(
                                    '<row r="1" ht="28" customHeight="1"><c r="A1" t="inlineStr" s="51"><is><t>Erode District Administration</t></is></c></row>' +
                                    '<row r="2" ht="22" customHeight="1"><c r="A2" t="inlineStr" s="51"><is><t>Record Room</t></is></c></row>' +
                                    '<row r="3" ht="20" customHeight="1"><c r="A3" t="inlineStr" s="51"><is><t>Generated on: ' + today + '</t></is></c></row>' +
                                    '<row r="4" ht="26" customHeight="1"><c r="A4" t="inlineStr" s="51"><is><t>OLD REGISTER OUTSTANDING REPORT</t></is></c></row>' +
                                    '<row r="5"></row>'
                                );
                                var mergeCells = $sheet.find('mergeCells');
                                if (!mergeCells.length) {
                                    mergeCells = $('<mergeCells count="0"/>');
                                    $sheet.append(mergeCells);
                                }
                                mergeCells.append('<mergeCell ref="A1:L1"/>');
                                mergeCells.append('<mergeCell ref="A2:L2"/>');
                                mergeCells.append('<mergeCell ref="A3:L3"/>');
                                mergeCells.append('<mergeCell ref="A4:L4"/>');
                                var currentCount = parseFloat(mergeCells.attr('count')) || 0;
                                mergeCells.attr('count', currentCount + 4);
                                var colWidths = [];
                                $('row', sheet).each(function () {
                                    var r = parseInt($(this).attr('r'));
                                    if (r > 5) {
                                        $('c', this).each(function (i) {
                                            var text = $('t', this).text();
                                            var len = text ? text.length : 0;
                                            colWidths[i] = Math.max(colWidths[i] || 10, len);
                                        });
                                    }
                                });
                                var colsXml = '<cols>';
                                colWidths.forEach(function (w, i) {
                                    colsXml += '<col min="' + (i + 1) + '" max="' + (i + 1) + '" width="' + Math.min(w + 5, 50) + '"/>';
                                });
                                colsXml += '</cols>';
                                $sheet.find('worksheet').prepend(colsXml);
                            },
                            exportOptions: { columns: ':visible' }
                        }
                    ],
                    "responsive": false,
                    "lengthChange": false,
                    "autoWidth": false,
                    "scrollX": true,
                    "scrollCollapse": true,
                    "searching": true,
                    "pageLength": 100
                });
            });
        </script>

        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <table id="example1" class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th>Sr. No.</th>
                                    <th>Record Serial No</th>
                                    <th>Year</th>
                                    <th>Details</th>
                                    <th>Type</th>
                                    <th>Taluk</th>
                                    <th>Village</th>
                                    <th>Date of Outgoing</th>
                                    <th>Purpose of Taking</th>
                                    <th>Section Person Name</th>
                                    <th>Section Phone No</th>
                                    <th>Record Room Person</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="outstandingRecords, iterStat : ${outstandingRecords}">
                                    <td th:text="${iterStat.index + 1}"></td>
                                    <td th:text="${outstandingRecords.master.record_serial_no}"></td>
                                    <td th:text="${outstandingRecords.master.year}"></td>
                                    <td th:text="${outstandingRecords.master.details_of_record}"></td>
                                    <td th:text="${outstandingRecords.master.types_of_record}"></td>
                                    <td th:text="${outstandingRecords.master.taluk}"></td>
                                    <td th:text="${outstandingRecords.master.village}"></td>
                                    <td th:text="${outstandingRecords.dateOfOutGoing}"></td>
                                    <td th:text="${outstandingRecords.purposeTakingOut}"></td>
                                    <td th:text="${outstandingRecords.sectionPersonName_out}"></td>
                                    <td th:text="${outstandingRecords.sectionPersonName_number}"></td>
                                    <td th:text="${outstandingRecords.recordPersonName_out}"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</html>